<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background-color: black;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100vh;
            margin: 0;
            padding: 0;
            color: rgb(135, 0, 0);
        }
        #timer {
            background-color: rgb(121, 0, 0);
            border-radius: 50%;
        }
        .clock-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: calc((100vh - 100vmin) / 2);
        }
        #current-time, #remaining-time {
            font-size: 20vw;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="clock-container">
        <div id="current-time"></div>
    </div>
    <canvas id="timer"></canvas>
    <div class="clock-container">
        <div id="remaining-time"></div>
    </div>
    <script>
        function setColors() {
            var now = new Date();
            var minutes = now.getMinutes();
            if ((minutes >= 0 && minutes < 15) || (minutes >= 30 && minutes < 45)){
                document.body.style.color = "rgb(135, 0, 0)";
                document.getElementById('timer').style.backgroundColor = "rgb(121, 0, 0)";
            } else {
                document.body.style.color = "RGB(186, 132, 0)";
                document.getElementById('timer').style.backgroundColor = "RGB(186, 132, 0)";
            }
        }
        var now = new Date();
        var minutes = now.getMinutes();
        var countdown = ((15 - minutes % 15) * 60) - now.getSeconds();
        var canvas = document.getElementById('timer');
        var size = Math.min(window.innerWidth, window.innerHeight);
        canvas.width = size;
        canvas.height = size;
        var ctx = canvas.getContext('2d');
        var center = {x: canvas.width / 2, y: canvas.height / 2};
        var radius = canvas.width / 2;
        var startAngle = -0.5 * Math.PI;
        var endAngle = startAngle - 2 * Math.PI * ((15*60 - countdown) / (15*60));
        function drawCircle() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        function drawCountdown() {
            ctx.beginPath();
            ctx.arc(center.x, center.y, radius, startAngle, endAngle, true);
            ctx.lineTo(center.x, center.y);
            ctx.fillStyle = 'black';
            ctx.fill();
        }
        function formatTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            var seconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        function playTone(frequency = 440, duration = 500) {
            var audioContext = new (window.AudioContext || window.webkitAudioContext)();
            var oscillator = audioContext.createOscillator();
            oscillator.frequency.value = frequency;
            oscillator.type = "square";
            oscillator.connect(audioContext.destination);
            oscillator.start();
            setTimeout(function() {
                oscillator.stop();
            }, duration);
        }
        function calculateCountdown() {
            var now = new Date();
            var minutes = now.getMinutes();
            var seconds = now.getSeconds();
            var countdown = ((15 - (minutes % 15)) * 60) - seconds;
            if (minutes % 15 == 0 && seconds == 0) {
                playTone(440, 500);
            }
            return countdown;
        }
        setInterval(function() {
            countdown = calculateCountdown(); // recalculate countdown based on system time
            endAngle = startAngle - 2 * Math.PI * ((15*60 - countdown) / (15*60));
            drawCircle();
            drawCountdown();
            var now = new Date();
            document.getElementById('current-time').textContent = formatTime(now.getHours() * 60 + now.getMinutes());
            document.getElementById('remaining-time').textContent = formatTime(countdown);
            setColors(); // Set the colors based on the current time
        }, 1000);
    </script>
</body>
</html>